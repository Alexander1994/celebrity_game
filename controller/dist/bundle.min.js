!function(){function e(t,n,r){function a(s,c){if(!n[s]){if(!t[s]){var i="function"==typeof require&&require;if(!c&&i)return i(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return a(n||e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)a(r[s]);return a}return e}()({1:[function(e,t,n){t.exports={env:{prod:{signaling_server_url:"celebritygamesignalingserver-env-1.3xaq596cgf.us-east-2.elasticbeanstalk.com",signaling_server_port:9090,public:!1},dev:{signaling_server_url:"127.0.0.1",signaling_server_port:9090,public:!1},app:{signaling_server_url:"celebritygamesignalingserver-env-1.3xaq596cgf.us-east-2.elasticbeanstalk.com",signaling_server_port:9090,public:!0}},curr_env:"prod"}},{}],2:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("./env.json")),o=a.default.env[a.default.curr_env];n.env=o},{"./env.json":1}],3:[function(e,t,n){"use strict";function r(e){if(!a.env.public){var t="object"==typeof e?JSON.stringify(e):e;o.insertAdjacentHTML("beforeend","<p>"+t+"</p>")}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../../env/env"),o=document.querySelector("#debug"),s=function(e){return e.style.display="none"};a.env.public&&s(o),n.Debug=r},{"../../../env/env":2}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.States={start:"start",player_data:"player_data",pre_game:"pre_game",celeb_name_phase:"celeb_name_phase",pre_game_start:"pre_game_start",game_phase:"game_phase",waiting_phase:"waiting_phase",score_phase:"score_phase"};var r=function(){function e(){}return e.setState=function(t){e.currentState=t;for(var n=0;n<e.stateEls.length;n++){var r=e.stateEls[n];r.id===t?r.style.display="block":"block"===r.style.display&&(r.style.display="none")}},e.stateEls=document.querySelectorAll(".state"),e.currentState=n.States.start,e}();n.Loader=r},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./ServerConnection"),a=function(){function e(){this.reconnectKey="ReconnectKey"}return e.prototype.setReconnectID=function(e){localStorage.setItem(this.reconnectKey,e)},e.prototype.removeReconnectToken=function(){localStorage.removeItem(this.reconnectKey)},e.prototype.isPreviousConnPresent=function(){return null!==localStorage.getItem(this.reconnectKey)},e.prototype.getPreviousPlayerConnID=function(){return localStorage.getItem(this.reconnectKey)},e.prototype.getGameID=function(){return r.ServerConnection.ExtractGameIDFromPlayerID(this.getPreviousPlayerConnID())},e}();n.ReconnectStorage=a},{"./ServerConnection":6}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../env/env"),a=e("../../../shared/MessageTypes"),o=function(){function e(e,t){this.serverName=r.env.signaling_server_url,this.port=r.env.signaling_server_port,this.connectionName="ws://"+this.serverName+":"+this.port,this.longestMessageDelay=0,this.connectedToGame=!1,this.serverConnection=new WebSocket(this.connectionName),this.serverConnection.onmessage=e.bind(this),this.serverConnection.onopen=function(){console.log("Connected to the signaling server."),t()},this.serverConnection.onerror=function(e){console.log("Got error on trying to connect to the signaling server:",e)}}return e.ExtractGameIDFromPlayerID=function(e){return e.substr(0,4)},e.prototype.setPlayerID=function(e){this.playerID=e},e.prototype.setGameID=function(e){this.gameID=e},e.prototype.close=function(){this.serverConnection.close()},e.prototype.joinGame=function(e){this.gameID=e,this.send({src:"new_player",dest:e,type:a.Msg_Type.Join_Game})},e.prototype.reconnectAs=function(e,t){this.send({src:t,dest:e,type:a.Msg_Type.Reconnect,data:{msg_data_type:a.Msg_Data_Type.Reconnect}})},e.prototype.passMsg=function(e){e.time_sent=this.currUnixTime(),this.send({src:this.playerID,dest:this.gameID,type:a.Msg_Type.Pass_Msg,data:e})},e.prototype.setMsgDelay=function(e){var t=this.currUnixTime();if("data"in e){var n=t-e.data.time_sent;this.longestMessageDelay<n&&(this.longestMessageDelay=n)}},e.prototype.timeToGameStart=function(){return 4*this.longestMessageDelay},e.prototype.currUnixTime=function(){return(new Date).getTime()},e.prototype.currTimeDisplay=function(){return(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},e.prototype.send=function(e){console.log("sending...",this.currTimeDisplay()),console.log(e),console.trace(),this.serverConnection.send(JSON.stringify(e))},e}();n.ServerConnection=o},{"../../../env/env":2,"../../../shared/MessageTypes":9}],7:[function(e,t,n){"use strict";function r(e){var t=JSON.parse(e.data);if(this.setMsgDelay(t),console.log("message received: ",C.currTimeDisplay()),console.log(t),t.type===v.Msg_Type.Join_Game)C.setPlayerID(t.dest),b.setReconnectID(t.dest),t.success?y.Loader.setState(y.States.player_data):alert("invalid Game ID");else if(t.type===v.Msg_Type.Leave)alert("The Game app has lost connection with the server"),b.removeReconnectToken();else if(t.type===v.Msg_Type.Reconnect)i(t);else if(t.type===v.Msg_Type.Pass_Msg)switch(t.data.msg_data_type){case v.Msg_Data_Type.CurrentPlayersTurn:a(t.data);break;case v.Msg_Data_Type.Response:o(t.data);break;case v.Msg_Data_Type.GameConfiguration:s(t.data);break;case v.Msg_Data_Type.PlayerTurnData:c(t.data);break;default:alert("msg with invalid data type received")}}function a(e){var t=e;void 0!==t.end_of_game&&(T(J),b.removeReconnectToken()),t.is_players_turn?(T(L),T(j),M(U)):(S(L),S(j),D(U))}function o(e){var t=e;t.success?t.sent_msg===v.Msg_Data_Type.CanStartGame&&u():alert(t.error_msg)}function s(e){y.Loader.setState(y.States.celeb_name_phase);var t=e;K=t.turn_length}function c(e){var t=e;p(t.celebs),0===F.length?y.Loader.setState(y.States.waiting_phase):_()}function i(e){if(e.success){C.setPlayerID(e.dest),C.setGameID(e.src);var t=e.data;t.is_curr_players_action&&a({msg_data_type:v.Msg_Data_Type.CurrentPlayersTurn,is_players_turn:!0});var n=y.States[t.reconnect_state];n===y.States.pre_game&&(R.innerText="Welcome "+t.players_name+"!"),y.Loader.setState(n)}else b.removeReconnectToken()}function u(){var e=C.timeToGameStart(),t=C.currUnixTime(),n=t+e;setTimeout(function(){A.start(),h.Debug({real_start_time:(new Date).getTime()})},e);var r={msg_data_type:v.Msg_Data_Type.StartGame,game_start_time:n};C.passMsg(r),y.Loader.setState(y.States.pre_game_start),h.Debug({currUnixTime:t,startGameTime:n})}function l(){y.Loader.setState(y.States.score_phase);var e=Y.length-Q.length,t=e>=0?e:0;g(t);var n={msg_data_type:v.Msg_Data_Type.TurnScore,score:t,unused_celebs:F.slice(H)};C.passMsg(n)}function p(e){H=0,Q=[],Y=[],F=void 0===e?[]:e}function _(){H<F.length?$.innerText=F[H]:(clearTimeout(W),l())}function g(e){X.innerText="Questions skipped: "+Q.length,Z.innerText="Correctly guessed questions: "+Y.length,ee.innerText="Current round score: "+e}Object.defineProperty(n,"__esModule",{value:!0});var y=e("./Loader"),m=e("../../../shared/CountDown"),d=e("./ServerConnection"),v=e("../../../shared/MessageTypes"),f=e("./ReconnectStorage"),h=e("./Debug");y.Loader.setState(y.States.start);var S=function(e){return e.style.display="none"},T=function(e){return e.style.display="block"},D=function(e){return e.forEach(function(e){return S(e)})},M=function(e){return e.forEach(function(e){return T(e)})},b=new f.ReconnectStorage,C=new d.ServerConnection(r,function(){if(b.isPreviousConnPresent()){var e=b.getPreviousPlayerConnID(),t=b.getGameID();C.reconnectAs(t,e)}}),P=document.querySelector("#connectGameBtn"),I=document.querySelector("#gameIDInput");P.addEventListener("click",function(e){C.joinGame(I.value.toUpperCase())});var G=document.querySelector("#playerNameInput"),q=document.querySelector("#playerDataBtn"),k=document.querySelector("#playerTeamSelect");q.addEventListener("click",function(e){var t=G.value;if(""===t)return void alert("please enter a name");var n=parseInt(k.value);C.passMsg({msg_data_type:v.Msg_Data_Type.PlayerInfo,player_name:t,player_team:n}),R.innerText="Welcome "+t+"!",y.Loader.setState(y.States.pre_game)});var w=document.querySelector("#playerTurnLengthInput"),x=document.querySelector("#sendGameConfigurationBtn"),L=document.querySelector("#gameConfiguration"),R=document.querySelector("#preGameWelcome");x.addEventListener("click",function(e){var t=parseInt(w.value);if(isNaN(t)||t<=0)return void alert("Please enter a valid time length");var n={msg_data_type:v.Msg_Data_Type.GameConfiguration,turn_length:t};C.passMsg(n)});var E=document.querySelector("#celebNameInput"),N=document.querySelector("#sendCelebBtn");N.addEventListener("click",function(){var e=E.value;if(""===e.trim())return void alert("Please enter a celeb name");E.value="";var t={msg_data_type:v.Msg_Data_Type.CelebName,celeb_name:e};C.passMsg(t)});var j=document.querySelector("#startGameBtn");j.addEventListener("click",function(){var e={msg_data_type:v.Msg_Data_Type.CanStartGame};C.passMsg(e)});var O=document.querySelector("#countDownTimer"),B=3,A=m.newCountDown(B,O,function(){y.Loader.setState(y.States.game_phase),W=setTimeout(l,1e3*K)}),U=document.querySelectorAll(".startYourTurnBtn"),J=document.querySelector("#gameOver");U.forEach(function(e){return e.addEventListener("click",u)});var K,W,F=[],H=0,Q=[],Y=[],$=document.querySelector("#currCeleb"),z=document.querySelector("#nextBtn"),V=document.querySelector("#skipBtn");V.addEventListener("click",function(){Q.push(F[H]),H++,_()}),z.addEventListener("click",function(){Y.push(F[H]),H++,_()});var X=document.querySelector("#skipped"),Z=document.querySelector("#guessed"),ee=document.querySelector("#totalScore")},{"../../../shared/CountDown":8,"../../../shared/MessageTypes":9,"./Debug":3,"./Loader":4,"./ReconnectStorage":5,"./ServerConnection":6}],8:[function(e,t,n){"use strict";function r(e,t,n){function r(){if(t.innerText=u,s=setTimeout(r,Math.max(o+1e3*(e-i+1)-l(),0)),i--,u=a(i),i===c)return n(),void clearTimeout(s)}var o,s,c=-1,i=e,u=a(e),l=function(){return(new Date).getTime()},p=function(){u=a(e),i=e};return{stop:function(){clearTimeout(s)},start:function(){p(),o=l(),r()},stopAndCallCB:function(){n(),this.stop()},isActive:function(){return i!==c}}}Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){var t=e/60|0,n=e%60|0,r=(t<10?"0":"")+t,a=(n<10?"0":"")+n;return r+":"+a};n.newCountDown=r},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){e.Create_Game="create_game",e.Join_Game="join_game",e.Pass_Msg="pass_msg",e.Leave="leave",e.Reconnect="reconnect",e.Broadcast="broadcast",e.Broadcast_To_All_Except="broadcast_to_all_except"}(r=n.Msg_Type||(n.Msg_Type={}));var a;!function(e){e[e.PlayerInfo=0]="PlayerInfo",e[e.CelebName=1]="CelebName",e[e.StartGame=2]="StartGame",e[e.PlayerTurnData=3]="PlayerTurnData",e[e.TurnStart=4]="TurnStart",e[e.CurrentPlayersTurn=5]="CurrentPlayersTurn",e[e.Response=6]="Response",e[e.GameConfiguration=7]="GameConfiguration",e[e.TurnScore=8]="TurnScore",e[e.CanStartGame=9]="CanStartGame",e[e.Reconnect=10]="Reconnect"}(a=n.Msg_Data_Type||(n.Msg_Data_Type={}));var o;!function(e){e.Player_Data="player_data",e.Pre_Game="pre_game",e.Celeb_Name_Phase="celeb_name_phase",e.Waiting_Phase="waiting_phase"}(o=n.Reconnect_State||(n.Reconnect_State={}))},{}]},{},[7]);
