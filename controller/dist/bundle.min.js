!function(){function e(t,n,r){function a(s,c){if(!n[s]){if(!t[s]){var i="function"==typeof require&&require;if(!c&&i)return i(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return a(n||e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)a(r[s]);return a}return e}()({1:[function(e,t,n){t.exports={env:{prod:{signaling_server_url:"celebritygamesignalingserver-env-1.3xaq596cgf.us-east-2.elasticbeanstalk.com",signaling_server_port:9090,public:!1},dev:{signaling_server_url:"127.0.0.1",signaling_server_port:9090,public:!1},app:{signaling_server_url:"celebritygamesignalingserver-env-1.3xaq596cgf.us-east-2.elasticbeanstalk.com",signaling_server_port:9090,public:!0}},curr_env:"prod"}},{}],2:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("./env.json")),o=a.default.env[a.default.curr_env];n.env=o},{"./env.json":1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.States={start:"start",player_data:"player_data",pre_game:"pre_game",celeb_name_phase:"celeb_name_phase",pre_game_start:"pre_game_start",game_phase:"game_phase",waiting_phase:"waiting_phase",score_phase:"score_phase"};var r=function(){function e(){}return e.setState=function(t){e.currentState=t;for(var n=0;n<e.stateEls.length;n++){var r=e.stateEls[n];r.id===t?r.style.display="block":"block"===r.style.display&&(r.style.display="none")}},e.stateEls=document.querySelectorAll(".state"),e.currentState=n.States.start,e}();n.Loader=r},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./ServerConnection"),a=function(){function e(){this.reconnectKey="ReconnectKey"}return e.prototype.setReconnectID=function(e){localStorage.setItem(this.reconnectKey,e)},e.prototype.removeReconnectToken=function(){localStorage.removeItem(this.reconnectKey)},e.prototype.isPreviousConnPresent=function(){return null!==localStorage.getItem(this.reconnectKey)},e.prototype.getPreviousPlayerConnID=function(){return localStorage.getItem(this.reconnectKey)},e.prototype.getGameID=function(){return r.ServerConnection.ExtractGameIDFromPlayerID(this.getPreviousPlayerConnID())},e}();n.ReconnectStorage=a},{"./ServerConnection":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../env/env"),a=e("../../../shared/MessageTypes"),o=function(){function e(e,t){this.serverName=r.env.signaling_server_url,this.port=r.env.signaling_server_port,this.connectionName="ws://"+this.serverName+":"+this.port,this.longestMessageDelay=0,this.connectedToGame=!1,this.serverConnection=new WebSocket(this.connectionName),this.serverConnection.onmessage=e.bind(this),this.serverConnection.onopen=function(){console.log("Connected to the signaling server."),t()},this.serverConnection.onerror=function(e){console.log("Got error on trying to connect to the signaling server:",e)}}return e.ExtractGameIDFromPlayerID=function(e){return e.substr(0,4)},e.prototype.setPlayerID=function(e){this.playerID=e},e.prototype.setGameID=function(e){this.gameID=e},e.prototype.close=function(){this.serverConnection.close()},e.prototype.joinGame=function(e){this.gameID=e,this.send({src:"new_player",dest:e,type:a.Msg_Type.Join_Game})},e.prototype.reconnectAs=function(e,t){this.send({src:t,dest:e,type:a.Msg_Type.Reconnect,data:{msg_data_type:a.Msg_Data_Type.Reconnect}})},e.prototype.passMsg=function(e){e.time_sent=this.currUnixTime(),this.send({src:this.playerID,dest:this.gameID,type:a.Msg_Type.Pass_Msg,data:e})},e.prototype.setMsgDelay=function(e){var t=this.currUnixTime();if("data"in e){var n=t-e.data.time_sent;this.longestMessageDelay<n&&(this.longestMessageDelay=n)}},e.prototype.timeToGameStart=function(){return 3*this.longestMessageDelay},e.prototype.currUnixTime=function(){return(new Date).getTime()},e.prototype.currTimeDisplay=function(){return(new Date).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},e.prototype.send=function(e){console.log("sending...",this.currTimeDisplay()),console.log(e),console.trace(),this.serverConnection.send(JSON.stringify(e))},e}();n.ServerConnection=o},{"../../../env/env":2,"../../../shared/MessageTypes":8}],6:[function(e,t,n){"use strict";function r(e){var t=JSON.parse(e.data);if(this.setMsgDelay(t),console.log("message received: ",C.currTimeDisplay()),console.log(t),t.type===v.Msg_Type.Join_Game)C.setPlayerID(t.dest),M.setReconnectID(t.dest),t.success?m.Loader.setState(m.States.player_data):alert("invalid Game ID");else if(t.type===v.Msg_Type.Leave)alert("The Game app has lost connection with the server"),M.removeReconnectToken();else if(t.type===v.Msg_Type.Reconnect)i(t);else if(t.type===v.Msg_Type.Pass_Msg)switch(t.data.msg_data_type){case v.Msg_Data_Type.CurrentPlayersTurn:a(t.data);break;case v.Msg_Data_Type.Response:o(t.data);break;case v.Msg_Data_Type.GameConfiguration:s(t.data);break;case v.Msg_Data_Type.PlayerTurnData:c(t.data);break;default:alert("msg with invalid data type received")}}function a(e){var t=e;void 0!==t.end_of_game&&(S(U),M.removeReconnectToken()),t.is_players_turn?(S(x),S(N),D(A)):(h(x),h(N),T(A))}function o(e){var t=e;t.success?t.sent_msg===v.Msg_Data_Type.CanStartGame&&u():alert(t.error_msg)}function s(e){m.Loader.setState(m.States.celeb_name_phase);var t=e;K=t.turn_length}function c(e){var t=e;p(t.celebs),0===W.length?m.Loader.setState(m.States.waiting_phase):_()}function i(e){if(e.success){C.setPlayerID(e.dest),C.setGameID(e.src);var t=e.data;t.is_curr_players_action&&a({msg_data_type:v.Msg_Data_Type.CurrentPlayersTurn,is_players_turn:!0});var n=m.States[t.reconnect_state];n===m.States.pre_game&&(L.innerText="Welcome "+t.players_name+"!"),m.Loader.setState(n)}else M.removeReconnectToken()}function u(){var e=C.timeToGameStart(),t=C.currUnixTime(),n=t+e,r={msg_data_type:v.Msg_Data_Type.StartGame,game_start_time:n};C.passMsg(r),setTimeout(B.start,e),console.log("starting game at: "+n),m.Loader.setState(m.States.pre_game_start)}function l(){m.Loader.setState(m.States.score_phase);var e=Y.length-Q.length,t=e>=0?e:0;g(t);var n={msg_data_type:v.Msg_Data_Type.TurnScore,score:t,unused_celebs:W.slice(F)};C.passMsg(n)}function p(e){F=0,Q=[],Y=[],W=void 0===e?[]:e}function _(){F<W.length?$.innerText=W[F]:(clearTimeout(J),l())}function g(e){V.innerText="Questions skipped: "+Q.length,X.innerText="Correctly guessed questions: "+Y.length,Z.innerText="Current round score: "+e}Object.defineProperty(n,"__esModule",{value:!0});var m=e("./Loader"),y=e("../../../shared/CountDown"),d=e("./ServerConnection"),v=e("../../../shared/MessageTypes"),f=e("./ReconnectStorage");m.Loader.setState(m.States.start);var h=function(e){return e.style.display="none"},S=function(e){return e.style.display="block"},T=function(e){return e.forEach(function(e){return h(e)})},D=function(e){return e.forEach(function(e){return S(e)})},M=new f.ReconnectStorage,C=new d.ServerConnection(r,function(){if(M.isPreviousConnPresent()){var e=M.getPreviousPlayerConnID(),t=M.getGameID();C.reconnectAs(t,e)}}),b=document.querySelector("#connectGameBtn"),P=document.querySelector("#gameIDInput");b.addEventListener("click",function(e){C.joinGame(P.value.toUpperCase())});var I=document.querySelector("#playerNameInput"),G=document.querySelector("#playerDataBtn"),q=document.querySelector("#playerTeamSelect");G.addEventListener("click",function(e){var t=I.value;if(""===t)return void alert("please enter a name");var n=parseInt(q.value);C.passMsg({msg_data_type:v.Msg_Data_Type.PlayerInfo,player_name:t,player_team:n}),L.innerText="Welcome "+t+"!",m.Loader.setState(m.States.pre_game)});var k=document.querySelector("#playerTurnLengthInput"),w=document.querySelector("#sendGameConfigurationBtn"),x=document.querySelector("#gameConfiguration"),L=document.querySelector("#preGameWelcome");w.addEventListener("click",function(e){var t=parseInt(k.value);if(isNaN(t)||t<=0)return void alert("Please enter a valid time length");var n={msg_data_type:v.Msg_Data_Type.GameConfiguration,turn_length:t};C.passMsg(n)});var R=document.querySelector("#celebNameInput"),E=document.querySelector("#sendCelebBtn");E.addEventListener("click",function(){var e=R.value;if(""===e.trim())return void alert("Please enter a celeb name");R.value="";var t={msg_data_type:v.Msg_Data_Type.CelebName,celeb_name:e};C.passMsg(t)});var N=document.querySelector("#startGameBtn");N.addEventListener("click",function(){var e={msg_data_type:v.Msg_Data_Type.CanStartGame};C.passMsg(e)});var O=document.querySelector("#countDownTimer"),j=3,B=y.newCountDown(j,O,function(){m.Loader.setState(m.States.game_phase),J=setTimeout(l,1e3*K)}),A=document.querySelectorAll(".startYourTurnBtn"),U=document.querySelector("#gameOver");A.forEach(function(e){return e.addEventListener("click",u)});var K,J,W=[],F=0,Q=[],Y=[],$=document.querySelector("#currCeleb"),z=document.querySelector("#nextBtn"),H=document.querySelector("#skipBtn");H.addEventListener("click",function(){Q.push(W[F]),F++,_()}),z.addEventListener("click",function(){Y.push(W[F]),F++,_()});var V=document.querySelector("#skipped"),X=document.querySelector("#guessed"),Z=document.querySelector("#totalScore")},{"../../../shared/CountDown":7,"../../../shared/MessageTypes":8,"./Loader":3,"./ReconnectStorage":4,"./ServerConnection":5}],7:[function(e,t,n){"use strict";function r(e,t,n){function r(){if(t.innerText=u,s=setTimeout(r,Math.max(o+1e3*(e-i+1)-l(),0)),i--,u=a(i),i===c)return n(),void clearTimeout(s)}var o,s,c=-1,i=e,u=a(e),l=function(){return(new Date).getTime()},p=function(){u=a(e),i=e};return{stop:function(){clearTimeout(s)},start:function(){p(),o=l(),r()},stopAndCallCB:function(){n(),this.stop()},isActive:function(){return i!==c}}}Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){var t=e/60|0,n=e%60|0,r=(t<10?"0":"")+t,a=(n<10?"0":"")+n;return r+":"+a};n.newCountDown=r},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){e.Create_Game="create_game",e.Join_Game="join_game",e.Pass_Msg="pass_msg",e.Leave="leave",e.Reconnect="reconnect",e.Broadcast="broadcast",e.Broadcast_To_All_Except="broadcast_to_all_except"}(r=n.Msg_Type||(n.Msg_Type={}));var a;!function(e){e[e.PlayerInfo=0]="PlayerInfo",e[e.CelebName=1]="CelebName",e[e.StartGame=2]="StartGame",e[e.PlayerTurnData=3]="PlayerTurnData",e[e.TurnStart=4]="TurnStart",e[e.CurrentPlayersTurn=5]="CurrentPlayersTurn",e[e.Response=6]="Response",e[e.GameConfiguration=7]="GameConfiguration",e[e.TurnScore=8]="TurnScore",e[e.CanStartGame=9]="CanStartGame",e[e.Reconnect=10]="Reconnect"}(a=n.Msg_Data_Type||(n.Msg_Data_Type={}));var o;!function(e){e.Player_Data="player_data",e.Pre_Game="pre_game",e.Celeb_Name_Phase="celeb_name_phase",e.Waiting_Phase="waiting_phase"}(o=n.Reconnect_State||(n.Reconnect_State={}))},{}]},{},[6]);
