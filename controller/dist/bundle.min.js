!function(){function e(t,n,r){function a(s,i){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!i&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return a(n||e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)a(r[s]);return a}return e}()({1:[function(e,t,n){t.exports={env:{prod:{signaling_server_url:"celebritygamesignalingserver-env-1.3xaq596cgf.us-east-2.elasticbeanstalk.com",signaling_server_port:9090,public:!1},dev:{signaling_server_url:"127.0.0.1",signaling_server_port:9090,public:!1},app:{signaling_server_url:"celebritygamesignalingserver-env-1.3xaq596cgf.us-east-2.elasticbeanstalk.com",signaling_server_port:9090,public:!0}},curr_env:"app"}},{}],2:[function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});var a=r(e("./env.json")),o=a.default.env[a.default.curr_env];n.env=o},{"./env.json":1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.States={start:"start",player_data:"player_data",pre_game:"pre_game",celeb_name_phase:"celeb_name_phase",pre_game_start:"pre_game_start",game_phase:"game_phase",waiting_phase:"waiting_phase",score_phase:"score_phase"};var r=function(){function e(){}return e.setState=function(t){e.currentState=t;for(var n=0;n<e.stateEls.length;n++){var r=e.stateEls[n];r.id===t?r.style.display="block":"block"===r.style.display&&(r.style.display="none")}},e.stateEls=document.querySelectorAll(".state"),e.currentState=n.States.start,e}();n.Loader=r},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./ServerConnection"),a=function(){function e(){this.reconnectKey="ReconnectKey"}return e.prototype.setReconnectID=function(e){localStorage.setItem(this.reconnectKey,e)},e.prototype.removeReconnectToken=function(){localStorage.removeItem(this.reconnectKey)},e.prototype.isPreviousConnPresent=function(){return null!==localStorage.getItem(this.reconnectKey)},e.prototype.getPreviousPlayerConnID=function(){return localStorage.getItem(this.reconnectKey)},e.prototype.getGameID=function(){return r.ServerConnection.ExtractGameIDFromPlayerID(this.getPreviousPlayerConnID())},e}();n.ReconnectStorage=a},{"./ServerConnection":5}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../env/env"),a=e("../../../shared/MessageTypes"),o=e("../../../shared/Helpers"),s=function(){function e(e,t){this.serverName=r.env.signaling_server_url,this.port=r.env.signaling_server_port,this.connectionName="ws://"+this.serverName+":"+this.port,this.disconnectDisplay=document.querySelector("#disconnectDisplay"),this.reconnectCount=0,this.lastMessageDelay=0,this.connectedToGame=!1,this.startSocketConnection(e,t)}return e.prototype.startSocketConnection=function(e,t){this.serverConnection=new WebSocket(this.connectionName),this.serverConnection.onmessage=e;var n=this;this.serverConnection.onopen=function(){console.log("Connected to the signaling server."),t(),n.reconnectCount=0,o.hide(n.disconnectDisplay)},this.serverConnection.onerror=function(e){console.log("Got error on trying to connect to the signaling server:",e),o.display(n.disconnectDisplay)},this.serverConnection.onclose=function(r){n.reconnectCount++,setTimeout(function(){n.serverConnection=new WebSocket(n.connectionName),n.startSocketConnection(e,t)},Math.pow(8,n.reconnectCount)),o.display(n.disconnectDisplay)}},e.prototype.isClosed=function(){var e=this.serverConnection,t=e.readyState;return e.CLOSED===t||e.CLOSING===t},e.ExtractGameIDFromPlayerID=function(e){return e.substr(0,4)},e.prototype.setPlayerID=function(e){this.playerID=e},e.prototype.setGameID=function(e){this.gameID=e},e.prototype.close=function(){this.serverConnection.close()},e.prototype.sendTimeSync=function(){this.send({src:this.gameID,dest:"server",type:a.Msg_Type.Time_Sync,data:{}}),this.syncTimeSent=e.currUnixTime()},e.prototype.recvTimeSync=function(t){var n=e.currUnixTime(),r=n-this.syncTimeSent;e.serverTimeDiff=t.server_time-(n-r/2)},e.currUnixTime=function(){return(new Date).getTime()+e.serverTimeDiff},e.currTimeDisplay=function(){return e.timeToDisplay(e.currUnixTime())},e.timeToDisplay=function(e){return new Date(e).toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1")},e.prototype.joinGame=function(e){this.gameID=e,this.send({src:"new_player",dest:e,type:a.Msg_Type.Join_Game})},e.prototype.reconnectAs=function(e,t){this.send({src:t,dest:e,type:a.Msg_Type.Reconnect,data:{msg_data_type:a.Msg_Data_Type.Reconnect}})},e.prototype.passMsg=function(t){t.time_sent=e.currUnixTime(),this.send({src:this.playerID,dest:this.gameID,type:a.Msg_Type.Pass_Msg,data:t})},e.prototype.setMsgDelay=function(t){var n=e.currUnixTime();"data"in t&&"time_sent"in t.data&&(this.lastMessageDelay=n-t.data.time_sent)},e.prototype.timeToGameStart=function(){return 3*this.lastMessageDelay},e.prototype.send=function(t){console.log("sending...",e.currTimeDisplay()),console.log(t),console.trace(),this.serverConnection.send(JSON.stringify(t))},e.serverTimeDiff=0,e}();n.ServerConnection=s},{"../../../env/env":2,"../../../shared/Helpers":8,"../../../shared/MessageTypes":9}],6:[function(e,t,n){"use strict";function r(){T=new h.ServerConnection(a,function(){if(T.sendTimeSync(),D.isPreviousConnPresent()){var e=D.getPreviousPlayerConnID(),t=D.getGameID();T.reconnectAs(t,e)}})}function a(e){var t=JSON.parse(e.data);if(T.setMsgDelay(t),console.log("message received: ",h.ServerConnection.currTimeDisplay()),console.log(t),t.type===v.Msg_Type.Time_Sync)T.recvTimeSync(t.data);else if(t.type===v.Msg_Type.Join_Game)T.setPlayerID(t.dest),D.setReconnectID(t.dest),t.success?f.Loader.setState(f.States.player_data):alert("invalid Game ID");else if(t.type===v.Msg_Type.Leave)alert("The Game app has lost connection with the server"),D.removeReconnectToken();else if(t.type===v.Msg_Type.Reconnect)u(t);else if(t.type===v.Msg_Type.Pass_Msg)switch(t.data.msg_data_type){case v.Msg_Data_Type.CurrentPlayersTurn:o(t.data);break;case v.Msg_Data_Type.Response:s(t.data);break;case v.Msg_Data_Type.GameConfiguration:i(t.data);break;case v.Msg_Data_Type.PlayerTurnData:c(t.data);break;default:alert("msg with invalid data type received")}}function o(e){var t=e;void 0!==t.end_of_game&&(g.display(A),D.removeReconnectToken()),t.is_players_turn?(g.display(L),g.display(E),g.displayList(U)):(g.hide(L),g.hide(E),g.hideList(U))}function s(e){var t=e;t.success?t.sent_msg===v.Msg_Data_Type.CanStartGame&&l():alert(t.error_msg)}function i(e){f.Loader.setState(f.States.celeb_name_phase),K=e}function c(e){var t=e;d(t.celebs),0===J.length?f.Loader.setState(f.States.waiting_phase):y()}function u(e){if(e.success){T.setPlayerID(e.dest),T.setGameID(e.src);var t=e.data;K=t.game_config,t.is_curr_players_action&&o({msg_data_type:v.Msg_Data_Type.CurrentPlayersTurn,is_players_turn:!0});var n=f.States[t.reconnect_state];n===f.States.pre_game&&(x.innerText="Welcome "+t.players_name+"!"),f.Loader.setState(n)}else D.removeReconnectToken()}function l(){var e=T.timeToGameStart(),t=h.ServerConnection.currUnixTime(),n=t+e;setTimeout(function(){B.start(),g.hide(O)},e);var r={msg_data_type:v.Msg_Data_Type.StartGame,game_start_time:n};T.passMsg(r),g.display(O),f.Loader.setState(f.States.pre_game_start)}function p(e){e?g.display(V):g.hide(V);var t=Q.length;K.lose_point_on_skip&&(t-=F.length);var n=t>=0?t:0;m(n),f.Loader.setState(f.States.score_phase);var r={msg_data_type:v.Msg_Data_Type.TurnScore,score:n,unused_celebs:J.slice(H)};T.passMsg(r)}function d(e){H=0,F=[],Q=[],J=void 0===e?[]:e}function y(){H<J.length?Y.innerText=J[H]:(clearTimeout(W),p(!0))}function m(e){X.innerText="Questions skipped: "+F.length,Z.innerText="Correctly guessed questions: "+Q.length,ee.innerText="Current round score: "+e}Object.defineProperty(n,"__esModule",{value:!0});var _=e("../../../shared/CountDown"),g=e("../../../shared/Helpers"),v=e("../../../shared/MessageTypes"),f=e("./Loader"),h=e("./ServerConnection"),S=e("./ReconnectStorage");f.Loader.setState(f.States.start);var T,D=new S.ReconnectStorage;r(),document.addEventListener("visibilitychange",function(){document.hidden||void 0!==T&&!T.isClosed()||r()},!1);var C=document.querySelector("#connectGameBtn"),M=document.querySelector("#gameIDInput");C.addEventListener("click",function(e){T.joinGame(M.value.toUpperCase())});var P=document.querySelector("#playerNameInput"),b=document.querySelector("#playerDataBtn"),I=document.querySelector("#playerTeamSelect");b.addEventListener("click",function(e){var t=P.value;if(""===t)return void alert("please enter a name");var n=24;if(t.length>=n)return void alert("please enter a name smaller than "+n+" characters");var r=parseInt(I.value);T.passMsg({msg_data_type:v.Msg_Data_Type.PlayerInfo,player_name:t,player_team:r}),x.innerText="Welcome "+t+"!",f.Loader.setState(f.States.pre_game)});var G=document.querySelector("#playerTurnLengthInput"),k=document.querySelector("#losePointOnSkipCheckBox"),q=document.querySelector("#sendGameConfigurationBtn"),L=document.querySelector("#gameConfiguration"),x=document.querySelector("#preGameWelcome");q.addEventListener("click",function(e){var t=parseInt(G.value);if(isNaN(t)||t<=0)return void alert("Please enter a valid time length");var n={msg_data_type:v.Msg_Data_Type.GameConfiguration,turn_length:t,lose_point_on_skip:k.checked};T.passMsg(n)});var w=document.querySelector("#celebNameInput"),R=document.querySelector("#sendCelebBtn");R.addEventListener("click",function(){var e=w.value;if(""===e.trim())return void alert("Please enter a celeb name");w.value="";var t={msg_data_type:v.Msg_Data_Type.CelebName,celeb_name:e};T.passMsg(t)});var E=document.querySelector("#startGameBtn");E.addEventListener("click",function(){var e={msg_data_type:v.Msg_Data_Type.CanStartGame};T.passMsg(e)});var N=document.querySelector("#countDownTimer"),O=document.querySelector("#preGameLoading"),j=3,B=_.newCountDown(j,N,function(){f.Loader.setState(f.States.game_phase),W=setTimeout(function(){p(!1)},1e3*K.turn_length)}),U=document.querySelectorAll(".startYourTurnBtn"),A=document.querySelector("#gameOver");U.forEach(function(e){return e.addEventListener("click",l)});var K,W,J=[],H=0,F=[],Q=[],Y=document.querySelector("#currCeleb"),$=document.querySelector("#nextBtn"),z=document.querySelector("#skipBtn"),V=document.querySelector("#outOfPlayerDisplay");z.addEventListener("click",function(){F.push(J[H]),H++,y()}),$.addEventListener("click",function(){Q.push(J[H]),H++,y()});var X=document.querySelector("#skipped"),Z=document.querySelector("#guessed"),ee=document.querySelector("#totalScore")},{"../../../shared/CountDown":7,"../../../shared/Helpers":8,"../../../shared/MessageTypes":9,"./Loader":3,"./ReconnectStorage":4,"./ServerConnection":5}],7:[function(e,t,n){"use strict";function r(e,t,n){function r(){if(t.innerText=u,s=setTimeout(r,Math.max(o+1e3*(e-c+1)-l(),0)),c--,u=a(c),c===i)return n(),void clearTimeout(s)}var o,s,i=-1,c=e,u=a(e),l=function(){return(new Date).getTime()},p=function(){u=a(e),c=e};return{stop:function(){clearTimeout(s)},start:function(){p(),o=l(),r()},stopAndCallCB:function(){n(),this.stop()},isActive:function(){return c!==i}}}Object.defineProperty(n,"__esModule",{value:!0});var a=function(e){var t=e/60|0,n=e%60|0,r=(t<10?"0":"")+t,a=(n<10?"0":"")+n;return r+":"+a};n.newCountDown=r},{}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return"none"!==e.style.display};n.isDisplayed=r;var a=function(e){return e.style.display="none"};n.hide=a;var o=function(e){return e.style.display="block"};n.display=o;var s=function(e){return e.forEach(function(e){return a(e)})};n.hideList=s;var i=function(e){return e.forEach(function(e){return o(e)})};n.displayList=i},{}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){e.Create_Game="create_game",e.Join_Game="join_game",e.Pass_Msg="pass_msg",e.Leave="leave",e.Reconnect="reconnect",e.Broadcast="broadcast",e.Broadcast_To_All_Except="broadcast_to_all_except",e.Time_Sync="time_sync"}(r=n.Msg_Type||(n.Msg_Type={}));var a;!function(e){e[e.PlayerInfo=0]="PlayerInfo",e[e.CelebName=1]="CelebName",e[e.StartGame=2]="StartGame",e[e.PlayerTurnData=3]="PlayerTurnData",e[e.TurnStart=4]="TurnStart",e[e.CurrentPlayersTurn=5]="CurrentPlayersTurn",e[e.Response=6]="Response",e[e.GameConfiguration=7]="GameConfiguration",e[e.TurnScore=8]="TurnScore",e[e.CanStartGame=9]="CanStartGame",e[e.Reconnect=10]="Reconnect",e[e.TimeSync=11]="TimeSync"}(a=n.Msg_Data_Type||(n.Msg_Data_Type={}));var o;!function(e){e.Player_Data="player_data",e.Pre_Game="pre_game",e.Celeb_Name_Phase="celeb_name_phase",e.Waiting_Phase="waiting_phase"}(o=n.Reconnect_State||(n.Reconnect_State={}))},{}]},{},[6]);
