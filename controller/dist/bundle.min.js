!function(){function e(t,n,a){function r(o,i){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!i&&c)return c(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return r(n||e)},l,l.exports,e,t,n,a)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<a.length;o++)r(a[o]);return r}return e}()({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a={env:{prod:{signaling_server_url:"celebritygamesignalingserver-env-1.3xaq596cgf.us-east-2.elasticbeanstalk.com",signaling_server_port:9090,public:!1},dev:{signaling_server_url:"127.0.0.1",signaling_server_port:9090,public:!1},app:{signaling_server_url:"celebritygamesignalingserver-env-1.3xaq596cgf.us-east-2.elasticbeanstalk.com",signaling_server_port:9090,public:!0}},curr_env:"app"},r=a.env[a.curr_env];n.env=r},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t,n){if(isNaN(e)||e<=0||!isFinite(e))throw"invalid duration passed to countdown timer";this.duration=e,this.display=t,this.cb=n}return e.prototype.start=function(){function e(){return t=a.duration-((Date.now()-n)/1e3|0),a.display.textContent=a.timeToStr(t),0===t?(clearInterval(a.intervalId),void a.cb()):void(t<=0&&(n=Date.now()+1e3))}var t,n=Date.now(),a=this;e(),this.intervalId=setInterval(e,1e3)},e.prototype.stop=function(){clearInterval(this.intervalId)},e.prototype.stopAndCallCB=function(){this.stop(),this.cb()},e.prototype.isActive=function(){return"00:00"!==this.display.textContent},e.prototype.timeToStr=function(e){var t=e/60|0,n=e%60|0,a=(t<10?"0":"")+t,r=(n<10?"0":"")+n;return a+":"+r},e}();n.CountDown=a},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a;!function(e){e.start="start",e.player_data="player_data",e.pre_game="pre_game",e.celeb_name_phase="celeb_name_phase",e.pre_game_start="pre_game_start",e.game_phase="game_phase",e.waiting_phase="waiting_phase",e.score_phase="score_phase"}(a=n.States||(n.States={}));var r=function(){function e(){}return e.setState=function(t){e.currentState=t;for(var n=0;n<e.stateEls.length;n++){var a=e.stateEls[n];a.id===t?a.style.display="block":"block"===a.style.display&&(a.style.display="none")}},e.stateEls=document.querySelectorAll(".state"),e.currentState=a.start,e}();n.Loader=r},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a;!function(e){e.Create_Game="create_game",e.Join_Game="join_game",e.Pass_Msg="pass_msg",e.Leave="leave"}(a=n.Msg_Type||(n.Msg_Type={}));var r;!function(e){e[e.PlayerInfo=0]="PlayerInfo",e[e.CelebName=1]="CelebName",e[e.StartGame=2]="StartGame",e[e.PlayerTurnData=3]="PlayerTurnData",e[e.TurnStart=4]="TurnStart",e[e.CurrentPlayersTurn=5]="CurrentPlayersTurn",e[e.Response=6]="Response",e[e.GameConfiguration=7]="GameConfiguration",e[e.TurnScore=8]="TurnScore",e[e.CanStartGame=9]="CanStartGame"}(r=n.Msg_Data_Type||(n.Msg_Data_Type={}))},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../../env/env"),r=e("./MessageTypes"),s=function(){function e(e){this.serverName=a.env.signaling_server_url,this.port=a.env.signaling_server_port,this.connectionName="ws://"+this.serverName+":"+this.port,this.longestMessageDelay=0,this.connectedToGame=!1,this.serverConnection=new WebSocket(this.connectionName),this.serverConnection.onmessage=e.bind(this),this.serverConnection.onopen=function(){console.log("Connected to the signaling server.")},this.serverConnection.onerror=function(e){console.log("Got error on trying to connect to the signaling server:",e)}}return e.prototype.setPlayerID=function(e){this.playerID=e},e.prototype.close=function(){this.serverConnection.close()},e.prototype.joinGame=function(e){this.gameID=e,this.send({src:"new_player",dest:e,type:r.Msg_Type.Join_Game})},e.prototype.passMsg=function(e){e.time_sent=this.currUnixTime(),this.send({src:this.playerID,dest:this.gameID,type:r.Msg_Type.Pass_Msg,data:e})},e.prototype.setMsgDelay=function(e){var t=this.currUnixTime();if("data"in e){var n=t-e.data.time_sent;this.longestMessageDelay<n&&(this.longestMessageDelay=n)}},e.prototype.timeToGameStart=function(){return this.longestMessageDelay<500?500:3*this.longestMessageDelay},e.prototype.currUnixTime=function(){return(new Date).getTime()},e.prototype.send=function(e){console.log("sending..."),console.log(e),console.trace(),this.serverConnection.send(JSON.stringify(e))},e}();n.ServerConnection=s},{"../../../env/env":1,"./MessageTypes":4}],6:[function(e,t,n){"use strict";function a(e){var t=JSON.parse(e.data);if(this.setMsgDelay(t),console.log("message received: "),console.log(t),t.type===m.Msg_Type.Join_Game)S.setPlayerID(t.dest),t.success?_.Loader.setState(_.States.player_data):alert("invalid Game ID");else if(t.type===m.Msg_Type.Pass_Msg)switch(t.data.msg_data_type){case m.Msg_Data_Type.CurrentPlayersTurn:r(t.data);break;case m.Msg_Data_Type.Response:s(t.data);break;case m.Msg_Data_Type.GameConfiguration:o(t.data);break;case m.Msg_Data_Type.PlayerTurnData:i(t.data);break;default:alert("msg with invalid data type received")}}function r(e){var t=e;t.is_players_turn?(h(w),h(P),h(x)):(f(w),f(P),f(x))}function s(e){var t=e;t.success?t.sent_msg===m.Msg_Data_Type.CanStartGame&&u():alert(t.error_msg)}function o(e){_.Loader.setState(_.States.celeb_name_phase);var t=e;N=t.turn_length}function i(e){var t=e;p(t.celebs),0===O.length?_.Loader.setState(_.States.waiting_phase):g()}function c(){var e=3,t=new y.CountDown(e,k,function(){_.Loader.setState(_.States.game_phase),E=setTimeout(l,1e3*N)});t.start()}function u(){var e=S.timeToGameStart();setTimeout(c,e);var t=S.currUnixTime(),n=t+e,a={msg_data_type:m.Msg_Data_Type.StartGame,game_start_time:n};S.passMsg(a),console.log("starting game at: "+n),_.Loader.setState(_.States.pre_game_start)}function l(){_.Loader.setState(_.States.score_phase);var e=U.length-B.length,t=e>=0?e:0;d(t);var n={msg_data_type:m.Msg_Data_Type.TurnScore,score:t,unused_celebs:O.slice(j)};S.passMsg(n)}function p(e){j=0,B=[],U=[],O=void 0===e?[]:e}function g(){j<O.length?J.innerText=O[j]:(clearTimeout(E),l())}function d(e){F.innerText="Questions skipped: "+B.length,Q.innerText="Correctly guessed questions: "+U.length,W.innerText="Current round score: "+e}Object.defineProperty(n,"__esModule",{value:!0});var _=e("./Loader"),y=e("./CountDown"),v=e("./ServerConnection"),m=e("./MessageTypes");_.Loader.setState(_.States.start);var f=function(e){return e.style.display="none"},h=function(e){return e.style.display="block"},S=new v.ServerConnection(a),T=document.querySelector("#connectGameBtn"),M=document.querySelector("#gameIDInput");T.addEventListener("click",function(e){S.joinGame(M.value.toUpperCase())});var D=document.querySelector("#playerNameInput"),C=document.querySelector("#playerDataBtn"),b=document.querySelector("#playerTeamSelect");C.addEventListener("click",function(e){var t=D.value;if(""===t)return void alert("please enter a name");var n=parseInt(b.value);S.passMsg({msg_data_type:m.Msg_Data_Type.PlayerInfo,player_name:t,player_team:n}),_.Loader.setState(_.States.pre_game)});var q=document.querySelector("#playerTurnLengthInput"),G=document.querySelector("#sendGameConfigurationBtn"),w=document.querySelector("#gameConfiguration");G.addEventListener("click",function(e){var t=parseInt(q.value);if(isNaN(t)||t<=0)return void alert("Please enter a valid time length");var n={msg_data_type:m.Msg_Data_Type.GameConfiguration,turn_length:t};S.passMsg(n)});var I=document.querySelector("#celebNameInput"),L=document.querySelector("#sendCelebBtn");L.addEventListener("click",function(){var e=I.value;if(""===e.trim())return void alert("Please enter a celeb name");I.value="";var t={msg_data_type:m.Msg_Data_Type.CelebName,celeb_name:e};S.passMsg(t)});var P=document.querySelector("#startGameBtn");P.addEventListener("click",function(){var e={msg_data_type:m.Msg_Data_Type.CanStartGame};S.passMsg(e)});var k=document.querySelector("#countDownTimer"),x=document.querySelector("#startYourTurnBtn");x.addEventListener("click",function(){u()});var N,E,O=[],j=0,B=[],U=[],J=document.querySelector("#currCeleb"),A=document.querySelector("#nextBtn"),R=document.querySelector("#skipBtn");R.addEventListener("click",function(){B.push(O[j]),j++,g()}),A.addEventListener("click",function(){U.push(O[j]),j++,g()});var F=document.querySelector("#skipped"),Q=document.querySelector("#guessed"),W=document.querySelector("#totalScore")},{"./CountDown":2,"./Loader":3,"./MessageTypes":4,"./ServerConnection":5}]},{},[6]);
